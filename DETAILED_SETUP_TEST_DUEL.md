# GameState.setup_test_duel() ãƒ¡ã‚½ãƒƒãƒ‰è©³ç´°è§£èª¬

**å¯¾è±¡**: `GameState.setup_test_duel()`  
**å®Ÿè£…**: C++ (src/core/game_state.cpp) + Python (dm_ai_module.py)  
**ç”¨é€”**: ã‚²ãƒ¼ãƒ åˆæœŸåŒ–æ™‚ã®åŸºæœ¬çš„ãªçŠ¶æ…‹è¨­å®š

---

## æ¦‚è¦

### å½¹å‰²
```
ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã« GameState ã‚’ã€ŒåˆæœŸçŠ¶æ…‹ã€ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
ã™ã¹ã¦ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ã‚¾ãƒ¼ãƒ³ã€ã‚²ãƒ¼ãƒ å¤‰æ•°ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã‚’ä½œã‚‹
```

### å‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°
```
GameSession.initialize_game()
  â†“
GameInstance() ä½œæˆå¾Œ
  â†“
GameState.setup_test_duel() â† ã“ã“
  â†“
GameState.set_deck()
  â†“
PhaseManager.start_game()
```

### è²¬å‹™
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2äººã®åˆæœŸåŒ–
- ã™ã¹ã¦ã®ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
- ã‚²ãƒ¼ãƒ çŠ¶æ…‹å¤‰æ•°ã®ãƒªã‚»ãƒƒãƒˆ
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¥ã‚¨ãƒ«ç”¨ã®åŸºæœ¬çŠ¶æ…‹ä½œæˆ

---

## å®Ÿè£…è©³ç´°: Pythonç‰ˆï¼ˆdm_ai_module.pyï¼‰

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
```python
def setup_test_duel(self):
    """Initialize game state for test duels."""
    # Ensure we have 2 players
    self.players = [Player(0), Player(1)]
    
    # Clear all zones
    for p in self.players:
        p.hand.clear()
        p.mana_zone.clear()
        p.battle_zone.clear()
        p.shield_zone.clear()
        p.graveyard.clear()
        p.deck.clear()
    
    # Reset game state
    self.turn_number = 1
    self.active_player_id = 0
    self.current_phase = Phase.MANA
    self.game_over = False
    self.winner = -1
```

### å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—åˆ†è§£

#### ã‚¹ãƒ†ãƒƒãƒ—1ï¸âƒ£: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…åˆ—ã®ä½œæˆ
```python
self.players = [Player(0), Player(1)]
```

**å†…å®¹**:
- `Player(0)` ã¨ `Player(1)` ã®2ã¤ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
- ãƒªã‚¹ãƒˆå½¢å¼ã§ `self.players` ã«æ ¼ç´
- æ—¢å­˜ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚Œã°ã€æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ç½®ãæ›ãˆ

**å‚™è€ƒ**:
- Player ã‚¯ãƒ©ã‚¹ã® `__init__()` ã§å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå±æ€§ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹
- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDï¼ˆ0, 1ï¼‰ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§è¨­å®š

#### ã‚¹ãƒ†ãƒƒãƒ—2ï¸âƒ£: ã™ã¹ã¦ã®ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
```python
for p in self.players:
    p.hand.clear()              # æ‰‹æœ­ã‚’ã‚¯ãƒªã‚¢
    p.mana_zone.clear()         # ãƒãƒŠã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
    p.battle_zone.clear()       # ãƒãƒˆãƒ«ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
    p.shield_zone.clear()       # ã‚·ãƒ¼ãƒ«ãƒ‰ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
    p.graveyard.clear()         # å¢“åœ°ã‚’ã‚¯ãƒªã‚¢
    p.deck.clear()              # ãƒ‡ãƒƒã‚­ã‚’ã‚¯ãƒªã‚¢
```

**å†…å®¹**:
- 2äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãã‚Œãã‚Œã«å¯¾ã—ã¦ãƒ«ãƒ¼ãƒ—
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®6ã¤ã®ã‚¾ãƒ¼ãƒ³ã‚’ã™ã¹ã¦ç©ºã«ã™ã‚‹

**ã‚¾ãƒ¼ãƒ³ä¸€è¦§**:
| ã‚¾ãƒ¼ãƒ³å | å±æ€§å | èª¬æ˜ |
|---------|--------|------|
| æ‰‹æœ­ | `hand` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹ã«æŒã£ã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ |
| ãƒãƒŠ | `mana_zone` | ãƒªã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨æ¸ˆã¿ã®ã‚«ãƒ¼ãƒ‰ |
| ãƒãƒˆãƒ« | `battle_zone` | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å‡ºã¦ã„ã‚‹ã‚¯ãƒªãƒ¼ãƒãƒ£ãƒ¼ |
| ã‚·ãƒ¼ãƒ«ãƒ‰ | `shield_zone` | é˜²å¾¡ç”¨ã®ãƒ•ã‚§ã‚¤ã‚¹ãƒ€ã‚¦ãƒ³ã‚«ãƒ¼ãƒ‰ |
| å¢“åœ° | `graveyard` | ä½¿ç”¨æ¸ˆã¿/å€’ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ |
| ãƒ‡ãƒƒã‚­ | `deck` | å¼•ãç›´ã•ã‚Œå‰ã®ã‚«ãƒ¼ãƒ‰ï¼ˆ40æšï¼‰ |

#### ã‚¹ãƒ†ãƒƒãƒ—3ï¸âƒ£: ã‚²ãƒ¼ãƒ å¤‰æ•°ã®ãƒªã‚»ãƒƒãƒˆ
```python
self.turn_number = 1              # ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
self.active_player_id = 0         # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’P0ã«
self.current_phase = Phase.MANA   # ãƒ•ã‚§ãƒ¼ã‚ºã‚’ãƒãƒŠãƒ•ã‚§ãƒ¼ã‚ºã«
self.game_over = False            # ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ©ã‚°ã‚’ã‚ªãƒ•
self.winner = -1                  # å‹è€…ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆ-1 = æœªæ±ºå®šï¼‰
```

**å†…å®¹**:
- ã‚²ãƒ¼ãƒ é€²è¡Œã«é–¢ã™ã‚‹ã™ã¹ã¦ã®å¤‰æ•°ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™

**å„å¤‰æ•°ã®æ„å‘³**:
| å¤‰æ•° | å€¤ | èª¬æ˜ |
|------|-----|------|
| `turn_number` | 1 | 1ã‚¿ãƒ¼ãƒ³ç›® |
| `active_player_id` | 0 | Player 0 ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ– |
| `current_phase` | Phase.MANA (å€¤: 2) | ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸ãƒ•ã‚§ãƒ¼ã‚º |
| `game_over` | False | ã‚²ãƒ¼ãƒ é€²è¡Œä¸­ |
| `winner` | -1 | å‹è€…æœªæ±ºå®š |

---

## å®Ÿè£…è©³ç´°: C++ç‰ˆï¼ˆsrc/core/game_state.cppï¼‰

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
```cpp
void GameState::setup_test_duel() {
    // Simple setup for tests
    players.resize(2);
    for (size_t i = 0; i < players.size(); ++i) {
        players[i].id = static_cast<PlayerID>(i);
    }
    for(auto& p : players) {
        p.hand.clear();
        p.mana_zone.clear();
        p.battle_zone.clear();
        p.shield_zone.clear();
        p.graveyard.clear();
        p.deck.clear();
    }
    // Clear card_owner_map to reset instance_id counter
    card_owner_map.clear();
    turn_number = 1;
    active_player_id = 0;
    current_phase = Phase::START_OF_TURN;
}
```

### å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—åˆ†è§£

#### ã‚¹ãƒ†ãƒƒãƒ—1ï¸âƒ£: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é…åˆ—ã®åˆæœŸåŒ–
```cpp
players.resize(2);
for (size_t i = 0; i < players.size(); ++i) {
    players[i].id = static_cast<PlayerID>(i);
}
```

**å†…å®¹**:
- `players` ãƒ™ã‚¯ãƒˆãƒ«ã‚’ã‚µã‚¤ã‚º2ã«ãƒªã‚µã‚¤ã‚º
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã® ID ã‚’æ˜ç¤ºçš„ã«è¨­å®šï¼ˆ0, 1ï¼‰
- `PlayerID` å‹ã¸ã®ã‚­ãƒ£ã‚¹ãƒˆ

**Pythonç‰ˆã¨ã®é•ã„**:
- Python: æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆ`Player(0)`ï¼‰
- C++: æ—¢å­˜ãƒ™ã‚¯ãƒˆãƒ«ã‚’ãƒªã‚µã‚¤ã‚ºã—ã¦ ID ã‚’è¨­å®š

#### ã‚¹ãƒ†ãƒƒãƒ—2ï¸âƒ£: ã™ã¹ã¦ã®ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
```cpp
for(auto& p : players) {
    p.hand.clear();
    p.mana_zone.clear();
    p.battle_zone.clear();
    p.shield_zone.clear();
    p.graveyard.clear();
    p.deck.clear();
}
```

**å†…å®¹**: Pythonç‰ˆã¨åŒã˜ï¼ˆå„ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—3ï¸âƒ£: ã‚«ãƒ¼ãƒ‰æ‰€æœ‰è€…ãƒãƒƒãƒ—ã®ã‚¯ãƒªã‚¢
```cpp
card_owner_map.clear();
```

**å†…å®¹**:
- `card_owner_map` ã¯ ã‚«ãƒ¼ãƒ‰ instance_id â†’ player_id ã®å¯¾å¿œè¡¨
- ã“ã®ãƒãƒƒãƒ—ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ã“ã¨ã§ instance_id ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ

**ç›®çš„**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ç‹¬ç«‹æ€§ã‚’ç¢ºä¿ï¼ˆå‰ã®ãƒ†ã‚¹ãƒˆã®çŠ¶æ…‹ã‚’å¼•ãç¶™ãŒãªã„ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—4ï¸âƒ£: ã‚²ãƒ¼ãƒ å¤‰æ•°ã®ãƒªã‚»ãƒƒãƒˆ
```cpp
turn_number = 1;
active_player_id = 0;
current_phase = Phase::START_OF_TURN;
```

**å†…å®¹**: Pythonç‰ˆã¨ä¼¼ã¦ã„ã‚‹ãŒã€ãƒ•ã‚§ãƒ¼ã‚ºãŒç•°ãªã‚‹

**Python vs C++ ã®é•ã„**:
| é …ç›® | Python | C++ |
|------|--------|-----|
| `current_phase` | `Phase.MANA` (å€¤: 2) | `Phase::START_OF_TURN` (å€¤: ?) |
| åˆæœŸãƒ•ã‚§ãƒ¼ã‚º | ãƒãƒŠãƒ•ã‚§ãƒ¼ã‚ºã‹ã‚‰é–‹å§‹ | ã‚¿ãƒ¼ãƒ³é–‹å§‹ãƒ•ã‚§ãƒ¼ã‚ºã‹ã‚‰é–‹å§‹ |

---

## Python vs C++ ã®æ¯”è¼ƒ

### å…±é€šç‚¹
- âœ… ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2äººã‚’åˆæœŸåŒ–
- âœ… ã™ã¹ã¦ã®ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢
- âœ… ã‚¿ãƒ¼ãƒ³ç•ªå·ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
- âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’P0ã«è¨­å®š

### ç›¸é•ç‚¹

| å´é¢ | Python | C++ | ç†ç”± |
|------|--------|-----|------|
| **ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ** | æ–°è¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ | resize + IDè¨­å®š | è¨€èªä»•æ§˜ã®é•ã„ |
| **åˆæœŸãƒ•ã‚§ãƒ¼ã‚º** | Phase.MANA (2) | Phase::START_OF_TURN | C++å´ã§è©³ç´°ãƒ•ã‚§ãƒ¼ã‚ºå®šç¾© |
| **card_owner_map** | ä¸è¦ | æ˜ç¤ºçš„ã«ã‚¯ãƒªã‚¢ | C++å´ã§ã‚«ãƒ¼ãƒ‰è¿½è·¡ç”¨ |
| **game_over/winner** | æ˜ç¤ºçš„ã«ãƒªã‚»ãƒƒãƒˆ | è¨­å®šãªã— | åˆæœŸåŒ–æ™‚ç‚¹ã§ä¸è¦ |

### ãªãœç•°ãªã‚‹ã®ã‹ï¼Ÿ

```
Pythonç‰ˆã¯"ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯"
  - ãƒ†ã‚¹ãƒˆç”¨ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨
  - C++æ‹¡å¼µãŒãªã„æ™‚ã®ä»£æ›¿å®Ÿè£…
  - æ˜ç¢ºãªãƒªã‚»ãƒƒãƒˆå‡¦ç†

C++ç‰ˆã¯"æœ¬ä½“å®Ÿè£…"
  - å®Ÿéš›ã®ã‚²ãƒ¼ãƒ å®Ÿè¡Œç”¨
  - è¤‡é›‘ãªå†…éƒ¨çŠ¶æ…‹ï¼ˆcard_owner_mapï¼‰ã‚’ç®¡ç†
  - ã‚ˆã‚Šè©³ç´°ãªãƒ•ã‚§ãƒ¼ã‚ºåˆ¶å¾¡
```

---

## å‘¼ã³å‡ºã—å‰å¾Œã®çŠ¶æ…‹å¤‰åŒ–

### å‘¼ã³å‡ºã—å‰
```
GameInstanceä½œæˆç›´å¾Œ
â”‚
â”œâ”€ players: 0å€‹
â”œâ”€ hand: ä¸å®š
â”œâ”€ mana_zone: ä¸å®š
â”œâ”€ battle_zone: ä¸å®š
â”œâ”€ shield_zone: ä¸å®š
â”œâ”€ graveyard: ä¸å®š
â”œâ”€ deck: ä¸å®š
â”œâ”€ turn_number: 0 or ä¸å®š
â”œâ”€ active_player_id: 0 or ä¸å®š
â”œâ”€ current_phase: ä¸å®š
â”œâ”€ game_over: ä¸å®š
â””â”€ winner: ä¸å®š
```

### å‘¼ã³å‡ºã—å¾Œ
```
setup_test_duel()å®Ÿè¡Œå¾Œ
â”‚
â”œâ”€ players: [Player(0), Player(1)]  â† 2äºº
â”œâ”€ hand: []                          â† ç©º
â”œâ”€ mana_zone: []                     â† ç©º
â”œâ”€ battle_zone: []                   â† ç©º
â”œâ”€ shield_zone: []                   â† ç©º
â”œâ”€ graveyard: []                     â† ç©º
â”œâ”€ deck: []                          â† ç©ºï¼ˆå¾Œã§ set_deck() ã§è¨­å®šï¼‰
â”œâ”€ turn_number: 1                    â† ã‚¿ãƒ¼ãƒ³1
â”œâ”€ active_player_id: 0               â† P0ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–
â”œâ”€ current_phase: MANA (C++ã®ã¿)     â† ãƒãƒŠãƒ•ã‚§ãƒ¼ã‚º
â”œâ”€ game_over: False
â””â”€ winner: -1 (æœªæ±ºå®š)
```

---

## å‡¦ç†ãƒ•ãƒ­ãƒ¼å†…ã§ã®ä½ç½®ã¥ã‘

```
GameSession.initialize_game()
  â”‚
  â”œâ”€ 1ï¸âƒ£ JsonLoader.load_cards()      â† ã‚«ãƒ¼ãƒ‰DBèª­ã¿è¾¼ã¿
  â”‚
  â”œâ”€ 2ï¸âƒ£ GameInstance(seed, card_db) â† ã‚²ãƒ¼ãƒ ä½œæˆ
  â”‚
  â”œâ”€ 3ï¸âƒ£ setupLayout.setup_test_duel() â† â˜… ã“ã“
  â”‚      (ã‚²ãƒ¼ãƒ çŠ¶æ…‹åˆæœŸåŒ–)
  â”‚
  â”œâ”€ 4ï¸âƒ£ set_deck(0, deck0)           â† ãƒ‡ãƒƒã‚­1é…ç½®
  â”‚
  â”œâ”€ 5ï¸âƒ£ set_deck(1, deck1)           â† ãƒ‡ãƒƒã‚­2é…ç½®
  â”‚
  â”œâ”€ 6ï¸âƒ£ PhaseManager.start_game()    â† ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†
  â”‚      (ã‚·ãƒ¼ãƒ«ãƒ‰5æšã€åˆæœŸæ‰‹æœ­5æš)
  â”‚
  â””â”€ 7ï¸âƒ£ PhaseManager.fast_forward()  â† è‡ªå‹•é€²è¡Œ
         (MAIN ãƒ•ã‚§ãƒ¼ã‚ºã¾ã§)
  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setup_test_duel() ã®é‡è¦ãªå½¹å‰²ï¼š    â”‚
â”‚ = ãƒ‡ãƒƒã‚­é…ç½®å‰ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒƒãƒˆ      â”‚
â”‚ = "ç™½ç´™ã®çŠ¶æ…‹"ã‚’ä½œæˆ                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®è©³ç´°

### Player ã‚¯ãƒ©ã‚¹ ã®æ§‹æˆ

```python
class Player:
    def __init__(self, player_id: int = 0):
        self.player_id = player_id
        self.hand: List[CardStub] = []          # ãƒªã‚¹ãƒˆ
        self.mana_zone: List[CardStub] = []     # ãƒªã‚¹ãƒˆ
        self.battle_zone: List[CardStub] = []   # ãƒªã‚¹ãƒˆ
        self.graveyard: List[CardStub] = []     # ãƒªã‚¹ãƒˆ
        self.shield_zone: List[CardStub] = []   # ãƒªã‚¹ãƒˆ
        self.deck: List[int] = []               # ãƒªã‚¹ãƒˆï¼ˆã‚«ãƒ¼ãƒ‰IDï¼‰
        self.life: int = 20                     # ãƒ©ã‚¤ãƒ•ãƒã‚¤ãƒ³ãƒˆ
```

### setup_test_duel() ãŒå¯¾è±¡ã¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```
Player ã®å±æ€§             | setup_test_duel()ã§ã®å‡¦ç†
--------------------------|------------------
 hand                     | .clear()
 mana_zone                | .clear()
 battle_zone              | .clear()
 shield_zone              | .clear()
 graveyard                | .clear()
 deck                     | .clear()
 life                     | å¤‰æ›´ãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ20ï¼‰
 player_id                | ã‚»ãƒƒãƒˆï¼ˆ0 or 1ï¼‰
```

---

## ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

### Q1: ãªãœ setup_test_duel() ã‚’å‘¼ã¶å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼Ÿ

**A**: 
```
GameInstanceä½œæˆç›´å¾Œã¯"ä¸å®š"ãªçŠ¶æ…‹
â†’ setup_test_duel() ã§"ã‚¯ãƒªãƒ¼ãƒ³ãªåˆæœŸçŠ¶æ…‹"ã‚’ä½œæˆ
â†’ ãã®å¾Œ set_deck() ã§ãƒ‡ãƒƒã‚­ã‚’è¨­å®š
â†’ ãã®å¾Œ start_game() ã§ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†ã‚’å®Ÿè¡Œ

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒãªã„ã¨ã€GameState ãŒ
ä¸å®Œå…¨ãªçŠ¶æ…‹ã§ãƒ‡ãƒƒã‚­è¨­å®šã•ã‚Œã¦ã—ã¾ã†
```

### Q2: deck.clear() ã•ã‚Œã‚‹ã®ã«ã€å¾Œã§ set_deck() ã§è¨­å®šã„ã‚‹ã®ã¯ãªãœï¼Ÿ

**A**:
```
1. setup_test_duel() ã§ã‚¾ãƒ¼ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒªã‚»ãƒƒãƒˆï¼‰
2. set_deck() ã§ 40 æšã®ã‚«ãƒ¼ãƒ‰ã‚’ deck ã«è¨­å®š
3. start_game() ã§ deck ã‹ã‚‰ shield / hand ã«ç§»å‹•

ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®è¨­è¨ˆã§ã€
å„æ®µéšã§çŠ¶æ…‹ã‚’ç¢ºèªãƒ»æ¤œè¨¼ã§ãã‚‹
```

### Q3: Python ã¨ C++ ã§åˆæœŸãƒ•ã‚§ãƒ¼ã‚ºãŒç•°ãªã‚‹ã®ã¯ãªãœï¼Ÿ

**A**:
```
Pythonç‰ˆ:
  - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ãªã®ã§ã€ã‚·ãƒ³ãƒ—ãƒ«
  - Phase.MANA (ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸é–‹å§‹)
  
C++ç‰ˆ:
  - ã‚ˆã‚Šè©³ç´°ãªãƒ•ã‚§ãƒ¼ã‚ºåˆ¶å¾¡
  - Phase::START_OF_TURN (ã‚¿ãƒ¼ãƒ³é–‹å§‹ãƒ•ã‚§ãƒ¼ã‚º)
  ã€€ã‹ã‚‰ã®å¾Œå‡¦ç†ã‚’è‡ªå‹•å®Ÿè¡Œ
  
å®Ÿéš›ã®å‡¦ç†é †åºã¯:
  START_OF_TURN â†’ DRAW â†’ MANA â†’ ...
  ãªã®ã§ã€C++å´ãŒ"æ­£ç¢º"
```

### Q4: game_over ã¨ winner ã‚’ãƒªã‚»ãƒƒãƒˆã—ãªã„ã®ã¯ãªãœï¼Ÿ

**A**:
```
GameInstance.__init__() ã§æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿
  game_over = false
  winner = -1
  
setup_test_duel() ã§ã¯æ”¹ã‚ã¦è¨­å®šã™ã‚‹å¿…è¦ãŒãªã„
ï¼ˆPythonç‰ˆã¯å¿µã®ãŸã‚æ˜ç¤ºçš„ã«ãƒªã‚»ãƒƒãƒˆï¼‰
```

### Q5: card_owner_map ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹æ„å‘³ã¯ï¼Ÿ

**A**: (C++ç‰ˆã®ã¿)
```
card_owner_map ã¯:
  CardID / instance_id â†’ PlayerID ã®å¯¾å¿œè¡¨
  
ã‚¯ãƒªã‚¢ã™ã‚‹ã“ã¨ã§:
  - å‰ã®ãƒ†ã‚¹ãƒˆ/å®Ÿè¡Œã® instance_id ã‚’å¿˜ã‚Œã‚‹
  - æ–°ã—ã„ instance_id ã‚’0ã‹ã‚‰å§‹ã‚ã‚‹
  - ãƒ†ã‚¹ãƒˆé–“ã§ã®ç‹¬ç«‹æ€§ã‚’ç¢ºä¿
```

---

## å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

### âœ… æ­£ã—ã„ä½¿ç”¨æ–¹æ³•
```python
# åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼
gs = GameState()
gs.setup_test_duel()           # å¿…ãšå‘¼ã³å‡ºã™
gs.set_deck(0, deck0)          # ãã®å¾Œãƒ‡ãƒƒã‚­è¨­å®š
gs.set_deck(1, deck1)
# ãã®å¾Œ start_game() ã¸
```

### âŒ é¿ã‘ã‚‹ã¹ãä½¿ç”¨æ–¹æ³•
```python
# âŒ setup_test_duel() ã‚’å‘¼ã°ãšã«ã‚²ãƒ¼ãƒ é–‹å§‹
gs = GameState()
gs.set_deck(0, deck0)          # å±é™ºï¼çŠ¶æ…‹ãŒä¸å®š
dm_ai_module.PhaseManager.start_game(gs)

# âŒ ãƒ‡ãƒƒã‚­è¨­å®šå¾Œã« setup_test_duel() ã‚’å‘¼ã¶
gs = GameState()
gs.set_deck(0, deck0)
gs.setup_test_duel()           # âš ï¸ ãƒ‡ãƒƒã‚­ãŒã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ï¼
```

### ğŸ’¡ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
```python
def initialize_game(seed: int = 42):
    """Common game initialization pattern"""
    # 1. GameInstance ä½œæˆ
    gi = GameInstance(seed, card_db)
    gs = gi.state
    
    # 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¥ã‚¨ãƒ«åˆæœŸåŒ–ï¼ˆé‡è¦ï¼ï¼‰
    gs.setup_test_duel()
    
    # 3. ãƒ‡ãƒƒã‚­è¨­å®š
    gs.set_deck(0, [1,2,3,4,5,6,7,8,9,10]*4)
    gs.set_deck(1, [1,2,3,4,5,6,7,8,9,10]*4)
    
    # 4. ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆC++å´ã§è©³ç´°åˆæœŸåŒ–ï¼‰
    PhaseManager.start_game(gs, card_db)
    
    return gi, gs
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒå¯Ÿ

### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡
```
setup_test_duel() ã®å‡¦ç†:
  - 2ã¤ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ: O(1)
  - 6ã¤ã®ã‚¾ãƒ¼ãƒ³ã®ã‚¯ãƒªã‚¢: O(1) (ç©ºãƒ»æœ€å°åŒ–)
  - ã‚²ãƒ¼ãƒ å¤‰æ•°ã®åˆæœŸåŒ–: O(1)
  
ç·è¨ˆ: O(1) - å¸¸æ™‚ã‚ªãƒ¼ãƒ€ãƒ¼ï¼ˆé«˜é€Ÿï¼‰
```

### å®Ÿè¡Œæ™‚é–“
```
æ¸¬å®šæƒ³å®š:
  - Pythonç‰ˆ: < 1ms
  - C++ç‰ˆ: < 0.1ms
  
ã‚²ãƒ¼ãƒ åˆæœŸåŒ–å…¨ä½“ã®ä¸­ã§ã¯
  ç„¡è¦–ã§ãã‚‹ã»ã©é«˜é€Ÿ
```

---

## ãƒ†ã‚¹ãƒˆä¾‹

### Python ã§ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```python
def test_setup_test_duel():
    # ãƒ†ã‚¹ãƒˆå¯¾è±¡
    gs = GameState()
    gs.setup_test_duel()
    
    # ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
    assert len(gs.players) == 2          # 2ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
    assert gs.players[0].player_id == 0
    assert gs.players[1].player_id == 1
    
    assert len(gs.players[0].hand) == 0  # æ‰‹æœ­ç©º
    assert len(gs.players[0].deck) == 0  # ãƒ‡ãƒƒã‚­ç©º
    
    assert gs.turn_number == 1           # ã‚¿ãƒ¼ãƒ³1
    assert gs.active_player_id == 0      # P0ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    assert gs.current_phase == Phase.MANA
    assert gs.game_over == False         # ã‚²ãƒ¼ãƒ é€²è¡Œä¸­
    assert gs.winner == -1               # å‹è€…æœªæ±ºå®š
    
    print("âœ… All tests passed")

# å®Ÿè¡Œ
test_setup_test_duel()
```

---

## ã¾ã¨ã‚

| é …ç›® | èª¬æ˜ |
|------|------|
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ã®åŸºç›¤ã¨ãªã‚‹çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ |
| **å‡¦ç†** | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ â†’ ã‚¾ãƒ¼ã‚¯ãƒªã‚¢ â†’ å¤‰æ•°ãƒªã‚»ãƒƒãƒˆ |
| **å®Ÿè£…** | Pythonï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰+ C++ï¼ˆæœ¬ä½“ï¼‰ |
| **ã‚¿ã‚¤ãƒŸãƒ³ã‚°** | GameInstance ä½œæˆå¾Œã€set_deck() å‰ |
| **é‡è¦æ€§** | â­â­â­â­â­ - å¿…é ˆå‡¦ç† |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** | O(1) - é«˜é€Ÿ |

**çµè«–**: `setup_test_duel()` ã¯ ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼ ã®**ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªç¬¬ä¸€æ­©**ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ä½œã‚‰ã‚ŒãŸã€Œã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã€ãŒã‚ã£ã¦ã“ãã€ãã®å¾Œã®å‡¦ç†ãŒæ­£ç¢ºã«æ©Ÿèƒ½ã™ã‚‹ã€‚
