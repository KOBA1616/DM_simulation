# システムアーキテクチャ概要 (System Architecture Overview)

## 1. はじめに
本プロジェクト「Duel Masters AI Simulator」は、トレーディングカードゲーム（TCG）「デュエル・マスターズ」の対戦シミュレーションおよびAI研究を行うための高性能なプラットフォームです。

このシステムは、TCG特有の複雑なルール処理を高速に実行する「C++製エンジン」と、機械学習やデータ分析を柔軟に行うための「Python環境」を統合したハイブリッドアーキテクチャを採用しています。

このドキュメントでは、本システムの内部構造を詳しく知らない方に向けて、その目的、機能、および全体的な仕組みを解説します。

## 2. プロジェクトの目的
このシステムは、単にカードゲームを遊ぶためのものではなく、主に以下の研究・分析目的のために設計されています。

1.  **メタゲームの解明 (Deck Evolution)**
    *   数千〜数万回の高速シミュレーションを通じて、どのデッキ構成が統計的に強いかを検証します。
    *   AI同士に対戦させ、環境（メタゲーム）における最強デッキを探索・進化させます。

2.  **高度なAIエージェントの育成**
    *   AlphaZeroなどの最新の強化学習アルゴリズムを用いて、人間と同等以上のプレイングスキルを持つAIを作成します。
    *   不完全情報ゲーム（相手の手札が見えない状態）における意思決定モデルを研究します。

3.  **カード能力の検証**
    *   新しいカードや能力を実装し、それらがゲームバランスにどのような影響を与えるかを定量的に評価します。

## 3. システムのできること（機能概要）

ユーザーは本システムを通じて以下のことができます。

*   **高速対戦シミュレーション**: C++エンジンのパワーにより、1秒間に数百〜数千回の対戦を実行できます。
*   **カードデータの作成・編集**: GUIベースの「カードエディタ」を使用し、プログラミングなしで新しいカードや効果を定義できます。
*   **AIの学習**: 自己対戦データを収集し、AIモデル（ニューラルネットワーク）を学習させることができます。
*   **対戦ログの可視化**: 複雑なゲーム状態をGUIで視覚的に確認し、AIの思考プロセスや勝敗の要因を分析できます。

## 4. アーキテクチャの全体像

本システムは、大きく分けて「**C++コア（エンジン部）**」と「**Pythonレイヤー（制御・学習部）**」の2層構造になっています。

### A. C++コア (The Engine)
システムの「心臓部」です。速度が求められる処理はすべてここに集約されています。
*   **役割**: ゲームルールの厳密な処理、ゾーン管理（マナ、バトルゾーン、シールドなど）、効果の解決、勝敗判定。
*   **特徴**: メモリ管理が最適化されており、探索アルゴリズム（MCTS）で数百万の局面を探索するのに耐えうる性能を持っています。

### B. Pythonレイヤー (The Brain & Tools)
システムの「頭脳」および「インターフェース」です。
*   **役割**: AIのニューラルネットワーク推論、学習ループの制御、GUIツールの提供。
*   **連携**: `dm_ai_module` という専用のライブラリ（バインディング）を通じて、Pythonから直接C++エンジンを操作します。これにより、「Pythonの書きやすさ」と「C++の速さ」を両立しています。

## 5. 主要コンポーネント解説

### 1. ゲームエンジン (`src/engine`)
ルールの審判員です。「フェーズ進行（マナチャージ→ドロー→メイン...）」や「クリーチャーの召喚」「呪文の詠唱」といったアクションを正確に処理します。
また、**Action System**により、カードの効果（例：「相手獣を破壊する」）を「破壊」という小さな命令（コマンド）に分解して実行します。

### 2. カードデータベース (`data/cards.json`)
すべてのカード情報はJSON形式のテキストファイルで管理されています。
プログラムのコードを変更することなく、このファイルを書き換えるだけでカードのパワーや能力を変更できます。

### 3. AI・探索モジュール (`src/ai`)
*   **MCTS (Monte Carlo Tree Search)**: 「もしこの手を指したらどうなるか？」をシミュレーションし、最善の手を探す探索アルゴリズムです。
*   **Lethal Solver**: 詰将棋のように、「このターンで確実に勝てる手順（リーサル）」が存在するかを瞬時に計算する専用ソルバーも搭載されています。

### 4. カードエディタ (GUI)
エンジニアでない人でもカードデータを編集できるツールです。
「コスト」「文明」「パワー」の設定や、「登場時効果」「シールド・トリガー」などの能力を、マウス操作でパズルのように組み合わせて作成できます。

---

## まとめ
**Duel Masters AI Simulator** は、**「C++の圧倒的な計算能力」**と**「Pythonの柔軟な分析環境」**、そして**「直感的なエディタ」**を組み合わせることで、カードゲームの戦略的深淵を科学的に解明するための強力なツールセットを提供します。
