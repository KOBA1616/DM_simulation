# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ãƒ•ãƒ­ãƒ¼ - æ‹…å½“ãƒ•ã‚¡ã‚¤ãƒ«ç¶²ç¾…å›³

**æ›´æ–°æ—¥**: 2026å¹´2æœˆ9æ—¥  
**å¯¾è±¡**: DM Simulation GUI - ã‚¢ãƒ—ãƒªèµ·å‹•ã‹ã‚‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã¾ã§

---

## ğŸ“Š ãƒ•ãƒ­ãƒ¼æ¦‚è¦å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 0: ã‚¹ã‚¯ãƒªãƒ—ãƒˆèµ·å‹•                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ scripts/run_gui.ps1                                            â”‚
â”‚ â””â”€> pythonw dm_toolkit/gui/app.py                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: GUI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dm_toolkit/gui/app.py :: GameWindow.__init__()                â”‚
â”‚  â”œâ”€ LogViewerç”Ÿæˆ â†’ UIè¡¨ç¤º                                     â”‚
â”‚  â”œâ”€ GameInputHandlerç”Ÿæˆ â†’ å…¥åŠ›å‡¦ç†                            â”‚
â”‚  â”œâ”€ GameSessionç”Ÿæˆ â†’ ã‚²ãƒ¼ãƒ ç®¡ç†                                â”‚
â”‚  â”œâ”€ CardDatabaseèª­ã¿è¾¼ã¿                                       â”‚
â”‚  â”œâ”€ initialize_game() å‘¼ã³å‡ºã—                                 â”‚
â”‚  â”œâ”€ LayoutBuilder.build() â†’ UIæ§‹ç¯‰                            â”‚
â”‚  â””â”€ ã‚¿ã‚¤ãƒãƒ¼è¨­å®š (AI vs AIè‡ªå‹•é€²è¡Œç”¨)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: ã‚²ãƒ¼ãƒ ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ dm_toolkit/gui/game_session.py :: GameSession.initialize_game() â”‚
â”‚  â”œâ”€ JsonLoader.load_cards("data/cards.json") [C++]            â”‚
â”‚  â”œâ”€ GameInstance(seed, card_db) ç”Ÿæˆ [C++]                   â”‚
â”‚  â”œâ”€ GameState.setup_test_duel() [C++]                        â”‚
â”‚  â”œâ”€ GameState.set_deck(0, deck0) [C++]                       â”‚
â”‚  â”œâ”€ GameState.set_deck(1, deck1) [C++]                       â”‚
â”‚  â”œâ”€ PhaseManager.start_game() [C++]                          â”‚
â”‚  â””â”€ PhaseManager.fast_forward() [C++]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— - AI vs AIè‡ªå‹•é€²è¡Œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (ã‚¿ã‚¤ãƒãƒ¼ã§å®šæœŸå‘¼ã³å‡ºã—)                                        â”‚
â”‚ GameSession.step_game() [æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ]                           â”‚
â”‚  â”œâ”€ GameInstance.step() [C++] â†’ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼†å®Ÿè¡Œ           â”‚
â”‚  â”œâ”€ UIæ›´æ–°                                                     â”‚
â”‚  â””â”€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼åˆ¤å®š                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 4: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— - Humanæ“ä½œæ™‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒªãƒƒã‚¯æ™‚)                                            â”‚
â”‚ GameInputHandler.handle_card_click()                          â”‚
â”‚  â”œâ”€ ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ                                                â”‚
â”‚  â””â”€ GameSession.execute_action()                             â”‚
â”‚       â””â”€ GameInstance.resolve_action() [C++]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å…¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã¨è²¬å‹™ä¸€è¦§

### PHASE 0: ã‚¹ã‚¯ãƒªãƒ—ãƒˆèµ·å‹•

#### `scripts/run_gui.ps1`
| é …ç›® | èª¬æ˜ |
|------|------|
| **å½¹å‰²** | GUIèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| **è²¬å‹™** | Pythonç’°å¢ƒè¨­å®šãŠã‚ˆã³GUIãƒ—ãƒ­ã‚»ã‚¹èµ·å‹• |
| **å‘¼ã³å‡ºã—å¯¾è±¡** | `dm_toolkit/gui/app.py` |
| **è¨€èª** | PowerShell |
| **å®Ÿè¡Œå†…å®¹** | `pythonw dm_toolkit/gui/app.py` |

---

### PHASE 1: GUI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–

#### `dm_toolkit/gui/app.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameWindow(QMainWindow)` |
| **å½¹å‰²** | GUIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `__init__()`, `update_ui()`, `reset_game()` |
| **è²¬å‹™** | <ul><li>ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç”Ÿæˆã¨UIé…ç½®</li><li>GameSessionç®¡ç†</li><li>ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡ï¼ˆã‚¿ã‚¤ãƒãƒ¼ï¼‰</li><li>å…¥åŠ›/å‡ºåŠ›ã®ä»²ä»‹</li><li>ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åŸºã¥ãUIæ›´æ–°</li></ul> |
| **ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** | PyQt5, dm_toolkit, dm_ai_module |
| **åˆæœŸåŒ–é †åº** | <ol><li>QMainWindowåˆæœŸåŒ–</li><li>LogViewerç”Ÿæˆ</li><li>GameInputHandlerç”Ÿæˆ</li><li>GameSessionç”Ÿæˆ</li><li>CardDatabaseèª­ã¿è¾¼ã¿</li><li>initialize_game() å‘¼ã³å‡ºã—</li><li>LayoutBuilderå®Ÿè¡Œ</li><li>ã‚¿ã‚¤ãƒãƒ¼è¨­å®š</li></ol> |
| **é‡è¦ãªå±æ€§** | `self.session`, `self.card_db`, `self.timer`, `self.is_running` |

#### `dm_toolkit/gui/game_session.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameSession` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç†ã¨C++ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã®æ©‹æ¸¡ã— |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `initialize_game()`, `step_game()`, `execute_action()`, `reset_game()` |
| **è²¬å‹™** | <ul><li>C++ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç®¡ç†</li><li>ãƒ‡ãƒƒã‚­ç®¡ç†</li><li>ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†ã¨åŒæœŸ</li><li>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆã¨å®Ÿè¡Œ</li><li>UIæ›´æ–°ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ</li></ul> |
| **ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** | dm_ai_module, engine.compat |
| **é‡è¦ãªå±æ€§** | `self.game_instance`, `self.gs` (GameState), `self.card_db`, `self.native_card_db` |
| **DEFAULT_DECK** | `[1,2,3,4,5,6,7,8,9,10]*4` (40ã‚«ãƒ¼ãƒ‰) |

#### `dm_toolkit/gui/input_handler.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameInputHandler` |
| **å½¹å‰²** | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å‡¦ç† |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `handle_card_click()`, `handle_player_click()` |
| **è²¬å‹™** | <ul><li>ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†</li><li>ã‚«ãƒ¼ãƒ‰é¸æŠç®¡ç†</li><li>ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ</li></ul> |
| **ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** | dm_toolkit.commands |

#### `dm_toolkit/gui/layout_builder.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `LayoutBuilder` |
| **å½¹å‰²** | UIè¦ç´ ã®å‹•çš„æ§‹ç¯‰ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `build()`, `update_player_display()`, `update_zones_display()` |
| **è²¬å‹™** | <ul><li>ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç”Ÿæˆ</li><li>ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé…ç½®</li><li>ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åŸºã¥ãè¡¨ç¤ºæ›´æ–°</li></ul> |

#### `dm_toolkit/gui/log_viewer.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `LogViewer(QTextEdit)` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ ãƒ­ã‚°è¡¨ç¤º |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `log_message()` |
| **è²¬å‹™** | <ul><li>ã‚²ãƒ¼ãƒ é€²è¡Œãƒ­ã‚°ã®è¡¨ç¤º</li><li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º</li></ul> |

---

### PHASE 2: ã‚²ãƒ¼ãƒ ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–ï¼ˆè©³ç´°ï¼‰

#### `dm_toolkit/engine/compat.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `EngineCompat` |
| **å½¹å‰²** | C++ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `load_cards_robust()`, `ExecuteCommand()`, `get_active_player_id()` |
| **è²¬å‹™** | <ul><li>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</li><li>ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã®ä»²ä»‹</li><li>ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®åŒæœŸ</li></ul> |

#### `dm_toolkit/commands.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦é–¢æ•°** | `generate_legal_commands()`, `declare_play_command()`, `attack_creature_command()` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ ã‚³ãƒãƒ³ãƒ‰ã®ç”Ÿæˆã¨æ¤œè¨¼ |
| **è²¬å‹™** | <ul><li>æ³•çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œç”Ÿæˆ</li><li>ã‚³ãƒãƒ³ãƒ‰å½¢å¼ã®å¤‰æ›</li><li>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¦¥å½“æ€§æ¤œè¨¼</li></ul> |

#### `dm_toolkit/dm_types.py`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameState`, `CardDB`, `Zone` ãªã© |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ ã®å‹å®šç¾© |
| **è²¬å‹™** | <ul><li>ãƒ‡ãƒ¼ã‚¿æ§‹é€ å®šç¾©</li><li>å‹å®‰å…¨æ€§ã®ç¢ºä¿</li></ul> |

---

### PHASE 2-3: C++ ã‚¨ãƒ³ã‚¸ãƒ³å±¤

#### `src/engine/game_instance.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameInstance` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç†ï¼ˆC++ å´ï¼‰ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `GameInstance()`, `step()`, `resolve_action()` |
| **è²¬å‹™** | <ul><li>ã‚²ãƒ¼ãƒ çŠ¶æ…‹ä¿æŒ</li><li>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆï¼ˆIntentç”Ÿæˆï¼‰</li><li>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œåˆ¶å¾¡</li><li>ãƒˆãƒªã‚¬ãƒ¼ç®¡ç†</li><li>ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ</li></ul> |
| **ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** | PhaseManager, IntentGenerator, GameLogicSystem |

#### `src/core/game_state.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `GameState` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ çŠ¶æ…‹è¡¨ç¾ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `setup_test_duel()`, `set_deck()`, `clone()`, `is_human_player()` |
| **è²¬å‹™** | <ul><li>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ç®¡ç†</li><li>ã‚¾ãƒ¼ãƒ³ç®¡ç†</li><li>ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†</li><li>ã‚¿ãƒ¼ãƒ³ç•ªå·ç®¡ç†</li></ul> |
| **é‡è¦ãªå±æ€§** | `players[]`, `current_phase`, `active_player_id`, `turn_number`, `player_modes[]` |

#### `src/engine/systems/flow/phase_manager.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `PhaseManager` |
| **å½¹å‰²** | ã‚²ãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç† |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `start_game()`, `start_turn()`, `next_phase()`, `fast_forward()` |
| **è²¬å‹™** | <ul><li>ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã®åˆæœŸåŒ–ï¼ˆã‚·ãƒ¼ãƒ‰5æšã€æ‰‹æœ­5æšï¼‰</li><li>ãƒ•ã‚§ãƒ¼ã‚ºé·ç§»åˆ¶å¾¡</li><li>ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚å‡¦ç†</li><li>è‡ªå‹•é€²è¡Œï¼ˆfast_forwardï¼‰</li></ul> |
| **é‡è¦ãªå‡¦ç†** | <ul><li>ã‚·ãƒ¼ãƒ«ãƒ‰é…ç½®: `move_card_cmd()` Ã— 5</li><li>åˆæœŸæ‰‹æœ­: `move_card_cmd()` Ã— 5</li><li>ãƒãƒŠãƒãƒ£ãƒ¼ã‚¸åˆæœŸåŒ–</li></ul> |

#### `src/engine/systems/intent/intent_generator.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `IntentGenerator` |
| **å½¹å‰²** | æ³•çš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œç”Ÿæˆ |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `generate_legal_actions()`, `generate_phase_actions()` |
| **è²¬å‹™** | <ul><li>ç¾åœ¨ãƒ•ã‚§ãƒ¼ã‚ºã«åŸºã¥ãåˆæ³•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ</li><li>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã«åŸºã¥ãå€™è£œé¸åˆ¥</li></ul> |

#### `src/engine/systems/card/json_loader.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦é–¢æ•°** | `JsonLoader::load_cards()` |
| **å½¹å‰²** | ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ |
| **è²¬å‹™** | <ul><li>JSONå½¢å¼ã®ã‚«ãƒ¼ãƒ‰å®šç¾©èª­ã¿è¾¼ã¿</li><li>CardRegistry ã¸ã®ç™»éŒ²</li></ul> |
| **å…¥åŠ›** | `data/cards.json` |

#### `src/engine/systems/card/card_registry.cpp/.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦ã‚¯ãƒ©ã‚¹** | `CardRegistry` |
| **å½¹å‰²** | ã‚«ãƒ¼ãƒ‰å®šç¾©ã®ä¸€å…ƒç®¡ç† |
| **ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰** | `load_from_json()`, `get_all_definitions_ptr()` |
| **è²¬å‹™** | <ul><li>ã‚«ãƒ¼ãƒ‰å®šç¾©ã®ä¿æŒ</li><li>ã‚«ãƒ¼ãƒ‰æƒ…å ±ã®å‚ç…§æä¾›</li></ul> |

#### `src/core/types.hpp`
| é …ç›® | èª¬æ˜ |
|------|------|
| **ä¸»è¦å‹å®šç¾©** | `Phase`, `PlayerMode`, `Zone`, `CardID` ãªã© |
| **å½¹å‰²** | å‹å®‰å…¨æ€§ã®ç¢ºä¿ |
| **è²¬å‹™** | <ul><li>åˆ—æŒ™å‹å®šç¾©</li><li>å®šæ•°å®šç¾©</li></ul> |

---

### PHASE 3: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆAI vs AIï¼‰

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼
```
GameWindow.timer.timeout (æ¯500ms)
  â””â”€> GameSession.step_phase()
       â””â”€> GameSession.step_game()
            â”œâ”€ is_human_player() ãƒã‚§ãƒƒã‚¯
            â”œâ”€ GameInstance.step() [C++]
            â”‚  â”œâ”€ IntentGenerator.generate_legal_actions()
            â”‚  â”œâ”€ AIé¸æŠå‡¦ç†
            â”‚  â””â”€ GameInstance.resolve_action()
            â”‚       â””â”€ GameLogicSystem.resolve_action()
            â””â”€ UIæ›´æ–° (callback_update_ui())
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `dm_toolkit/gui/game_session.py` - `step_game()`
- `dm_ai_module` (C++ extension) - `GameInstance.step()`, `resolve_action()`

---

### PHASE 4: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ï¼ˆHumanæ“ä½œï¼‰

#### å‡¦ç†ãƒ•ãƒ­ãƒ¼
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚¦ã‚¹ã‚¯ãƒªãƒƒã‚¯
  â””â”€> GameInputHandler.handle_card_click()
       â”œâ”€ ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
       â””â”€> GameSession.execute_action()
            â”œâ”€ ensure_executable_command() [dm_toolkit/unified_execution.py]
            â”œâ”€ GameInstance.resolve_action() [C++]
            â””â”€ UIæ›´æ–°
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `dm_toolkit/gui/input_handler.py` - `handle_card_click()`
- `dm_toolkit/gui/game_session.py` - `execute_action()`
- `dm_toolkit/commands.py` - `generate_legal_commands()`
- `dm_toolkit/unified_execution.py` - `ensure_executable_command()`

---

## ğŸ—‚ï¸ å®Œå…¨ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼

```
DM_simulation/
â”œâ”€ scripts/
â”‚  â””â”€ run_gui.ps1 .......................... [PHASE 0] Entry point
â”‚
â”œâ”€ data/
â”‚  â”œâ”€ cards.json .......................... Card definitions
â”‚  â”œâ”€ meta_decks.json ..................... Default deck data
â”‚  â””â”€ scenarios/ .......................... Test scenario files
â”‚
â”œâ”€ dm_toolkit/
â”‚  â”œâ”€ gui/
â”‚  â”‚  â”œâ”€ app.py ........................... [PHASE 1] GameWindowï¼ˆãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰
â”‚  â”‚  â”œâ”€ game_session.py ................. [PHASE 2-3] GameSessionï¼ˆã‚²ãƒ¼ãƒ ç®¡ç†ï¼‰
â”‚  â”‚  â”œâ”€ input_handler.py ................ [PHASE 4] å…¥åŠ›å‡¦ç†
â”‚  â”‚  â”œâ”€ layout_builder.py ............... [PHASE 1] UIæ§‹ç¯‰
â”‚  â”‚  â”œâ”€ log_viewer.py ................... [PHASE 1] ãƒ­ã‚°UI
â”‚  â”‚  â”œâ”€ game_state_display.py ........... ã‚²ãƒ¼ãƒ çŠ¶æ…‹è¡¨ç¤º
â”‚  â”‚  â””â”€ i18n.py ......................... å¤šè¨€èªå¯¾å¿œ
â”‚  â”‚
â”‚  â”œâ”€ engine/
â”‚  â”‚  â”œâ”€ compat.py ....................... [PHASE 2] C++ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚  â”‚  â””â”€ systems/
â”‚  â”‚       â”œâ”€ flow_manager.py ............ ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†
â”‚  â”‚       â””â”€ card_manager.py ............ ã‚«ãƒ¼ãƒ‰ç®¡ç†
â”‚  â”‚
â”‚  â”œâ”€ commands.py ........................ [PHASE 2-4] ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆ
â”‚  â”œâ”€ dm_types.py ........................ å‹å®šç¾©
â”‚  â””â”€ unified_execution.py ............... ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚
â”œâ”€ src/ (C++ Source)
â”‚  â”œâ”€ core/
â”‚  â”‚  â”œâ”€ game_state.cpp/.hpp ............ [PHASE 2] ã‚²ãƒ¼ãƒ çŠ¶æ…‹
â”‚  â”‚  â”œâ”€ types.hpp ...................... å‹å®šç¾©
â”‚  â”‚  â””â”€ card_instance.cpp/.hpp ......... ã‚«ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â”‚  â”‚
â”‚  â”œâ”€ engine/
â”‚  â”‚  â”œâ”€ game_instance.cpp/.hpp ........ [PHASE 2-3] ã‚²ãƒ¼ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â”‚  â”‚  â”œâ”€ game_logic_system.cpp/.hpp .... [PHASE 3-4] ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ systems/
â”‚  â”‚      â”œâ”€ flow/
â”‚  â”‚      â”‚  â”œâ”€ phase_manager.cpp/.hpp . [PHASE 2-3] ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†
â”‚  â”‚      â”‚  â””â”€ turn_system.cpp/.hpp ... ã‚¿ãƒ¼ãƒ³ç®¡ç†
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€ intent/
â”‚  â”‚      â”‚  â”œâ”€ intent_generator.cpp/.hpp [PHASE 3] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
â”‚  â”‚      â”‚  â””â”€ ai_selector.cpp/.hpp ... AIé¸æŠ
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€ card/
â”‚  â”‚      â”‚  â”œâ”€ json_loader.cpp/.hpp ... [PHASE 2] JSONèª­ã¿è¾¼ã¿
â”‚  â”‚      â”‚  â””â”€ card_registry.cpp/.hpp . [PHASE 2] ã‚«ãƒ¼ãƒ‰ç™»éŒ²ç°¿
â”‚  â”‚      â”‚
â”‚  â”‚      â””â”€ trigger/
â”‚  â”‚         â”œâ”€ trigger_manager.cpp/.hpp ãƒˆãƒªã‚¬ãƒ¼ç®¡ç†
â”‚  â”‚         â””â”€ pipeline_executor.cpp/.hpp ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ
â”‚  â”‚
â”‚  â””â”€ bindings/
â”‚     â”œâ”€ bind_core.cpp .................. Python ãƒ©ãƒƒãƒ”ãƒ³ã‚°ï¼ˆGameStateç­‰ï¼‰
â”‚     â”œâ”€ bind_game_instance.cpp ........ Python ãƒ©ãƒƒãƒ”ãƒ³ã‚°ï¼ˆGameInstanceç­‰ï¼‰
â”‚     â””â”€ bind_phase_manager.cpp ........ Python ãƒ©ãƒƒãƒ”ãƒ³ã‚°ï¼ˆPhaseManagerç­‰ï¼‰
â”‚
â”œâ”€ dm_ai_module.py ....................... [PHASE 2-4] Python fallbackå®Ÿè£…
â”œâ”€ dm_ai_module.pyi ...................... Type hints
â”‚
â””â”€ tests/
   â”œâ”€ test_*.py .......................... ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå„ç¨®
   â”œâ”€ conftest.py ........................ å…±é€šãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
   â””â”€ pytest.ini ......................... ãƒ†ã‚¹ãƒˆè¨­å®š
```

---

## ğŸ”„ å…¨å‡¦ç†ãƒ•ãƒ­ãƒ¼ã¨è²¬å‹™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹

| å‡¦ç†æ®µéš | Pythonå´ãƒ•ã‚¡ã‚¤ãƒ« | C++å´ãƒ•ã‚¡ã‚¤ãƒ« | ä¸»è¦è²¬å‹™ |
|---------|-----------------|-------------|--------|
| **PHASE-0: èµ·å‹•** | scripts/run_gui.ps1 | - | GUI ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹• |
| **PHASE-1: UIåˆæœŸåŒ–** | app.py | - | ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç”Ÿæˆã€UIæ§‹ç¯‰ |
| **PHASE-2: ã‚²ãƒ¼ãƒ åˆæœŸåŒ–** | game_session.py | game_instance.cpp, game_state.cpp | GameInstanceä½œæˆã€ãƒ‡ãƒƒã‚­è¨­å®š |
| **PHASE-2.5: ã‚²ãƒ¼ãƒ é–‹å§‹** | game_session.py | phase_manager.cpp | ã‚·ãƒ¼ãƒ‰/æ‰‹æœ­é…ç½®ã€ãƒ•ã‚§ãƒ¼ã‚ºé·ç§» |
| **PHASE-3: AIè‡ªå‹•é€²è¡Œ** | game_session.py | intent_generator.cpp, game_instance.cpp | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆâ†’å®Ÿè¡Œ |
| **PHASE-4: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›** | input_handler.py, commands.py | game_instance.cpp | ã‚³ãƒãƒ³ãƒ‰ç”Ÿæˆâ†’å®Ÿè¡Œ |
| **å‡ºåŠ›: UIæ›´æ–°** | layout_builder.py | - | ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’UIã«åæ˜  |

---

## ğŸ“Œ é‡è¦ãªç¶™ãç›®ï¼ˆInterface Pointsï¼‰

### Python â†” C++ Bridge Points

| #  | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ | å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ« |
|----|------------------|------------|
| 1  | `JsonLoader.load_cards()` | src/bindings/bind_core.cpp |
| 2  | `GameInstance(seed, card_db)` | src/bindings/bind_game_instance.cpp |
| 3  | `GameState.setup_test_duel()` | dm_ai_module.py + src/core/game_state.cpp |
| 4  | `GameState.set_deck()` | dm_ai_module.py + src/core/game_state.cpp |
| 5  | `PhaseManager.start_game()` | src/bindings/bind_phase_manager.cpp |
| 6  | `PhaseManager.fast_forward()` | src/bindings/bind_phase_manager.cpp |
| 7  | `GameInstance.step()` | dm_ai_module.py + src/engine/game_instance.cpp |
| 8  | `GameInstance.resolve_action()` | dm_ai_module.py + src/engine/game_instance.cpp |
| 9  | `GameState.is_human_player()` | dm_ai_module.py + src/core/game_state.cpp |

---

## ğŸ¯ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®ç®¡ç†
```
GameState (C++) â† GameInstance (C++)
   â†“
GameSession (Python) [self.gs ã¨ã—ã¦å‚ç…§]
   â†“
GameWindow (Python) [self.session.gs ã¨ã—ã¦å‚ç…§]
   â†“
LayoutBuilder (Python) [UIæ›´æ–°ç”¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹]
```

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ•ãƒ­ãƒ¼
```
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ: IntentGenerator (C++) or commands.py (Python)
  â†“
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ: AI selector (C++) or ãƒ¦ãƒ¼ã‚¶ãƒ¼ (GUI)
  â†“
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ: GameInstance.resolve_action() (C++)
  â†“
çŠ¶æ…‹æ›´æ–°: GameState (C++)
  â†“
UIæ›´æ–°é€šçŸ¥: callback â†’ LayoutBuilder.update()
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼šå…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚«ãƒãƒ¬ãƒƒã‚¸

- [x] ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (run_gui.ps1)
- [x] GUIã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ (GameWindow)
- [x] ã‚²ãƒ¼ãƒ ç®¡ç† (GameSession)
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› (GameInputHandler)
- [x] UIæ§‹ç¯‰ (LayoutBuilder)
- [x] ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ (C++ engine)
- [x] ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (JsonLoader, CardRegistry)
- [x] ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç† (PhaseManager)
- [x] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ (IntentGenerator, commands.py)
- [x] ã‚²ãƒ¼ãƒ çŠ¶æ…‹ (GameState)
- [x] Python-C++ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (dm_ai_module)

**çŠ¶æ…‹**: å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Œå…¨ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº† âœ…

